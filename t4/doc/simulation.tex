\section{Simulation Analysis}
\label{sec:simulation}

In this section we wrote a \textit{Ngspice} script to simulate the audio
amplifier circuit, using the transistor models provided in the .net script
(NPN for the gain stage and PNP for the output stage).
Finally we measured the output voltage gain in the passband,
the lower and upper 3dB cut off frequencies and the input and output
impedances.


The circuit studied had a cost of 9600.608 MU. Much of the cost can be 
attributable to the capacitors used. 


\begin{figure*}[h]
    \centering
    \begin{subfigure}{0.23\textwidth}
        \includegraphics[width=\linewidth, clip]{vo1.pdf}
        \label{fig:output1}
    \end{subfigure}
    \caption{v output Gain stage as function of time}
\end{figure*}


\begin{figure*}[h]
    \centering
    \begin{subfigure}{0.23\textwidth}
        \includegraphics[width=\linewidth, clip]{gainAC1.eps}
        \label{fig:output1}
    \end{subfigure}
    \begin{subfigure}{0.23\textwidth}
        \includegraphics[width=\linewidth, clip]{vo1f.pdf}
        \label{fig:output2}
    \end{subfigure}
    \caption{\small Gain in dB  in Gain Stage circut as function of frequency obtained from Octave; Gain in dB  in Gain Stage circut as function of frequency obtained from NGspice}
    \label{output_deviation}
\end{figure*}

\begin{figure*}[h]
    \centering
    \begin{subfigure}{0.23\textwidth}
        \includegraphics[width=\linewidth, clip]{vo2f.pdf}
        \label{fig:output1}
    \end{subfigure}
    \begin{subfigure}{0.23\textwidth}
        \includegraphics[width=\linewidth, clip]{gainACtotal-eps-converted-to.pdf}
        \label{fig:output2}
    \end{subfigure}
    \caption{\small Plot of the Gain in dB of the total circuit as function of frequency we got from Nsgice(left).
        Plot of the Gain in dB of the total circuit as function of frequency we got from the Theoretical Part(right)}
    \label{output_deviation}
\end{figure*}


\begin{table}
    \parbox{.45\linewidth}{
        \centering
        \begin{tabular}{|c|c|}
            \hline
            {\bf Name} & {\bf Value [A or V]} \\ \hline
            \input{GainStage_OP.tex}
        \end{tabular}
        \label{tab:GainStage_OP}
        \caption{Results of the DC analysis applied to the Gain Stage circuit}
    }
    \hfill
    \parbox{.45\linewidth}{
        \centering
        \begin{tabular}{|c|c|}
            {\bf Name} & {\bf Value [A or V]} \\ \hline
            \input{op_tab.tex}
            \hline
        \end{tabular}
        \label{tab:Spice_OP}
        \caption{Results of the OP analysis applied to the whole circuit by using the Ngspice}
    }
    \hfill
    \parbox{.45\linewidth}{
        \centering
        \begin{tabular}{|c|c|}
            {\bf Name} & {\bf Value [A or V]} \\ \hline
            \input{OutputStage_OP.tex}
            \hline
        \end{tabular}
        \label{tab:OutputStage_OP}
        \caption{Results of the DC analysis applied to the Output Stage circuit }
    }
\end{table}

As we can see, the value of voltage across $R_E$ calculated in the 
theoretical part is $3.055\%$ smaller than the one calculated with 
Ngspice and and that $VO1$ calculated in the theoretical part is 
$1.176\%$ bigger than the one calculated in NGspice.

Comparing the theoretical and simulation gain we get the following errors:
$E_{AV} = 24.43\%$ and $E_{AV1} = 15.9\%$.

According to the the output stage, we can see that $VO2$ calculated 
in the theoretical part is $\approx 1.676\%$ bigger than the value 
we get from spice.

\begin{table}
    \parbox{.45\linewidth}{
        \centering
        \begin{tabular}{|c|c|}
            \hline
            {\bf Name} & {\bf Impedance or Gain in dB} \\ \hline
            \input{GainStage_AC.tex}
        \end{tabular}
        \label{tab:GainStage_AC}
        \caption{Results of the Incremental Analysis applied to the Gain Stage in the theoretical part}
    }
    \hfill
    \parbox{.45\linewidth}{
        \centering
        \begin{tabular}{|c|c|}
            {\bf Name} & {\bf Impedance or Gain in dB} \\ \hline
            \input{OutputStage_AC.tex}
            \hline
        \end{tabular}
        \label{tab:OutputStage_AC}
        \caption{Results of the Incremental Analysis applied to the Output Stage in the theoretical part }
    }
    \hfill
    \parbox{.45\linewidth}{
        \centering
        \begin{tabular}{|c|c|}
            {\bf Name} & {\bf Value [A or V]} \\ \hline
            \input{Final.tex}
            \hline
        \end{tabular}
        \label{tab:Final}
        \caption{Impedance of input and output of the Amplifier and total gain of the circuit}
    }
\end{table}

The difference among values we got from Ngspice and Octave in the 
Operating Point influence the results we got in AC analysis.


By using the coupling capacitor we can block the dc components and 
decrease the cut off frequency. And by using the bypass capacitor we can 
increase the gain of the gain stage which is possible because we bypass 
a higher impedance component. 

The purpose of the resistor $R_c$ is to regulate the amount of current 
to stablish in the OP from which the output current from the circuit will change 
across that value. 